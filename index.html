<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Weltnachrichten ‚Äì Kurz & Neutral</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f4f6f8;
}
header {
  background: #111;
  color: #fff;
  padding: 12px;
  text-align: center;
}
nav {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 6px;
  padding: 10px;
  background: #fff;
}
nav button {
  padding: 6px 12px;
  border: none;
  cursor: pointer;
  background: #e0e0e0;
}
nav button.active {
  background: #111;
  color: #fff;
}
main {
  padding: 12px;
}
.article {
  background: #fff;
  padding: 10px;
  margin-bottom: 10px;
  border-left: 4px solid #ccc;
}
.multi {
  border-left: 4px solid #d32f2f;
  background: #fff4f4;
}
.date {
  font-size: 12px;
  color: #555;
}
.sources a {
  font-size: 12px;
  display: block;
}
footer {
  text-align: center;
  font-size: 12px;
  padding: 10px;
  color: #666;
}
</style>
</head>

<body>

<header>
  <h1>üåç Weltnachrichten</h1>
  <div id="lastUpdate"></div>
</header>

<nav id="categories"></nav>

<main id="news">
  <p>Lade Nachrichten‚Ä¶</p>
</main>

<footer>
  Daten werden maximal alle 12 Stunden aktualisiert
</footer>

<script>
/* =============================
   CACHE EINSTELLUNGEN
============================= */
const CACHE_KEY = "weltnews_cache_v1";
const CACHE_TIME = 12 * 60 * 60 * 1000;

/* =============================
   RSS FEEDS (STARK BEGRENZT)
============================= */
const feeds = {
  "Politik": [
    "https://www.reuters.com/rssFeed/world",
    "https://feeds.bbci.co.uk/news/world/rss.xml",
    "https://www.tagesschau.de/xml/rss2/"
  ],
  "Wirtschaft": [
    "https://www.reuters.com/rssFeed/business",
    "https://www.handelsblatt.com/contentexport/feed/schlagzeilen"
  ],
  "Deutschland": [
    "https://www.spiegel.de/schlagzeilen/tops/index.rss",
    "https://www.sueddeutsche.de/news/rss/uebersicht"
  ]
};

/* =============================
   INIT
============================= */
const newsEl = document.getElementById("news");
const navEl = document.getElementById("categories");
const lastUpdateEl = document.getElementById("lastUpdate");

let activeCategory = Object.keys(feeds)[0];

/* =============================
   CACHE FUNKTIONEN
============================= */
function loadCache() {
  const data = localStorage.getItem(CACHE_KEY);
  if (!data) return null;
  const parsed = JSON.parse(data);
  if (Date.now() - parsed.time > CACHE_TIME) return null;
  return parsed;
}

function saveCache(html) {
  localStorage.setItem(CACHE_KEY, JSON.stringify({
    time: Date.now(),
    html: html
  }));
}

/* =============================
   NAVIGATION
============================= */
function buildNav() {
  navEl.innerHTML = "";
  Object.keys(feeds).forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = cat;
    btn.onclick = () => {
      activeCategory = cat;
      document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      loadNews();
    };
    if (cat === activeCategory) btn.classList.add("active");
    navEl.appendChild(btn);
  });
}

/* =============================
   RSS LADEN (MIT CORS PROXY)
============================= */
async function loadRSS(url) {
  const proxy = "https://api.allorigins.win/raw?url=";
  const res = await fetch(proxy + encodeURIComponent(url));
  const text = await res.text();
  const xml = new DOMParser().parseFromString(text, "text/xml");
  return Array.from(xml.querySelectorAll("item")).slice(0, 2);
}

/* =============================
   NACHRICHTEN LADEN
============================= */
async function loadNews() {

  const cache = loadCache();
  if (cache) {
    newsEl.innerHTML = cache.html;
    lastUpdateEl.textContent = "Letzte Aktualisierung: " + new Date(cache.time).toLocaleString();
    return;
  }

  newsEl.innerHTML = "<p>Lade aktuelle Nachrichten‚Ä¶</p>";
  let html = "";

  for (const feed of feeds[activeCategory]) {
    try {
      const items = await loadRSS(feed);
      items.forEach(item => {
        const title = item.querySelector("title")?.textContent || "";
        const link = item.querySelector("link")?.textContent || "";
        const pubDate = item.querySelector("pubDate")?.textContent || "";

        html += `
        <div class="article">
          <div class="date">${pubDate}</div>
          <h3>${title}</h3>
          <div class="sources">
            <a href="${link}" target="_blank">${link}</a>
          </div>
        </div>`;
      });
    } catch (e) {
      console.warn("Feed Fehler", feed);
    }
  }

  newsEl.innerHTML = html || "<p>Keine aktuellen Nachrichten</p>";
  lastUpdateEl.textContent = "Letzte Aktualisierung: " + new Date().toLocaleString();
  saveCache(newsEl.innerHTML);
}

/* =============================
   START
============================= */
buildNav();
loadNews();
</script>

</body>
</html>
