<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Weltnachrichten ‚Äì KI-Zusammenfassung</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { margin:0; font-family:system-ui, Arial; background:#0b1220; color:#e5e7eb; }
header { position:sticky; top:0; background:#0f172a; padding:16px; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,.4); z-index:10; }
header h1 { margin:0; font-size:20px; }
.categories { display:flex; gap:10px; overflow-x:auto; padding:12px; }
.cat { padding:8px 14px; border-radius:999px; background:#1e293b; font-size:13px; cursor:pointer; white-space:nowrap; }
.cat.active { background:#38bdf8; color:#020617; font-weight:bold; }
main { padding:16px; max-width:900px; margin:auto; }
.topic { background:#111827; border-radius:16px; padding:16px; margin-bottom:20px; box-shadow:0 10px 25px rgba(0,0,0,.4); }
.topic h2 { margin:0 0 10px; font-size:18px; color:#f9fafb; }
.topic p { font-size:14px; line-height:1.6; color:#d1d5db; }
.sources { margin-top:12px; font-size:12px; }
.sources a { color:#38bdf8; text-decoration:none; display:block; margin-bottom:2px; }
</style>
</head>
<body>
<header>
  <h1>üåç Weltnachrichten ‚Äì Zusammenfassung</h1>
  <div class="categories" id="categories"></div>
</header>
<main id="news"></main>
<script>
const feeds = {
  "Alle": [
    "https://feeds.bbci.co.uk/news/world/rss.xml",
    "https://www.tagesschau.de/ausland/index~rss2.xml",
    "https://rss.cnn.com/rss/edition_world.rss"
  ],
  "Politik": ["https://feeds.bbci.co.uk/news/politics/rss.xml"],
  "Wirtschaft": ["https://feeds.bbci.co.uk/news/business/rss.xml"],
  "Technologie": ["https://feeds.bbci.co.uk/news/technology/rss.xml"],
  "Klima": ["https://feeds.bbci.co.uk/news/science_and_environment/rss.xml"]
};
const newsEl = document.getElementById("news");
const catEl = document.getElementById("categories");
function createCategories() {
  Object.keys(feeds).forEach((cat,i)=>{
    const btn=document.createElement("div");
    btn.className="cat"+(i===0?" active":"");
    btn.textContent=cat;
    btn.onclick=()=>{
      document.querySelectorAll('.cat').forEach(c=>c.classList.remove('active'));
      btn.classList.add('active');
      loadNews(cat);
    };
    catEl.appendChild(btn);
  });
}
async function translate(text){
  try{
    const r = await fetch("https://libretranslate.de/translate",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({q:text, source:"auto", target:"de"})
    });
    const d = await r.json();
    return d.translatedText||text;
  }catch{return text;}
}
function normalizeTitle(title){
  return title.toLowerCase().replace(/[^a-z0-9 ]/gi,'').split(' ').slice(0,6).join(' ');
}
function mergeSummaries(texts){
  const joined = texts.join(' ');
  const sentences = joined.split('. ').filter(s=>s.length>40);
  let result = sentences.slice(0,4).join('. ') + '.';
  if(result.length<100) result = joined.slice(0,120)+'‚Ä¶';
  return result;
}
async function loadNews(category="Alle"){
  newsEl.innerHTML="";
  const topics={};
  for(const feed of feeds[category]){
    try{
      const res = await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(feed));
      const xml = new DOMParser().parseFromString(await res.text(),"text/xml");
      const items = Array.from(xml.querySelectorAll("item")).slice(0,8);
      for(const item of items){
        const titleRaw = item.querySelector("title")?.textContent||"";
        const descRaw = item.querySelector("description")?.textContent?.replace(/<[^>]+>/g,'')||"";
        const link = item.querySelector("link")?.textContent||"";
        const key = normalizeTitle(titleRaw);
        if(!topics[key]) topics[key]={titles:[],texts:[],links:[]};
        topics[key].titles.push(titleRaw);
        topics[key].texts.push(descRaw);
        topics[key].links.push(link);
      }
    }catch(e){console.log("Feed Fehler:",feed,e);}
  }
  for(const key in topics){
    const topic = topics[key];
    const title = await translate(topic.titles[0]);
    const summary = await translate(mergeSummaries(topic.texts));
    const div=document.createElement("div");
    div.className="topic";
    div.innerHTML=`
      <h2>${title}</h2>
      <p>${summary}</p>
      <div class="sources">
        Quellen:
        ${topic.links.map(l=>`<a href="${l}" target="_blank">${l}</a>`).join('')}
      </div>
    `;
    newsEl.appendChild(div);
  }
}
createCategories();
loadNews();
setInterval(()=>loadNews(document.querySelector('.cat.active')?.textContent||'Alle'),5*60*1000);
</script>
</body>
</html>

